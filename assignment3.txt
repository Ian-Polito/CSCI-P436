In order to isolate the problem, it helps to reduce the amount of code ran. Then, the problem can be effectively debugged.

Mutexes are needed in the producer and consumer code.
